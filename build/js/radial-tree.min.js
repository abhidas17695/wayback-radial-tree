/*!
 * =============================================================
 * radial-tree v1.0.0 - Radial Tree Library for Wayback Machine
 * https://github.com/internetarchive/wayback-radial-tree#readme
 *
 * (c) 2017 - Eagle19243
 * =============================================================
 */

!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.RadialTree=t(e.jQuery)}(this,function(e){function t(e,t){function r(e,t,r,l){var o=e.querySelector(".div-btn");e.querySelector(".year-btn")||r.forEach(function(s,c){var u=document.createElement("button");u.setAttribute("class","year-btn"),u.setAttribute("id",r[c]),u.innerHTML=r[c],u.onclick=function(o){var s=o.target;e.querySelector(".active-btn")&&e.querySelector(".active-btn").classList.remove("active-btn"),s.classList.add("active-btn"),i=s.id;var c=r.indexOf(s.id),u=a(c,l);n(e,t,u)},o.appendChild(u),c==r.length-1&&u.click()})}function n(e,t,r){function n(e){for(var t=i,r=e.ancestors().reverse(),n="",a=1;a<r.length&&"end"!=r[a].data.name;a++)n=n+"/"+r[a].data.name;var l="https://web.archive.org/web/"+t+"0630"+n;window.open(l)}function a(e){var t=e.ancestors().reverse();t.shift(),o(t),d3.selectAll("path").style("opacity",.3),p.selectAll("path").filter(function(e){return t.indexOf(e)>=0}).style("opacity",1)}function l(t){e.querySelector(".sequence").innerHTML="",d3.selectAll("path").on("mouseover",null),d3.selectAll("path").transition().style("opacity",1).on("end",function(){d3.select(this).on("mouseover",a)})}function o(t){var r=t,n=e.querySelector(".sequence"),a="",i=document.createElement("span");i.setAttribute("class","symb"),i.innerHTML="/";for(var l=0;l<r.length;l++)a=0==l?" "+r[l].data.name:a+i.innerHTML+r[l].data.name;n.innerHTML=a}e.querySelector(".sequence").innerHTML="",e.querySelector("#chart").innerHTML="";var s=e.querySelector("#chart").offsetWidth,c=e.querySelector("#chart").offsetWidth,u=Math.min(s,c)/2,d=d3.scaleOrdinal(d3.schemeCategory20b),h=0,p=d3.select("#chart").append("svg:svg").attr("width",s).attr("height",c).append("svg:g").attr("id","d3_container").attr("transform","translate("+s/2+","+c/2+")"),f=d3.partition().size([2*Math.PI,u*u]),v=d3.arc().startAngle(function(e){return e.x0}).endAngle(function(e){return e.x1}).innerRadius(function(e){return Math.sqrt(e.y0)}).outerRadius(function(e){return Math.sqrt(e.y1)}),m=d3.csvParseRows(r),g=function(e){e.sort(function(e,t){return e[0].length-t[0].length||e[0].localeCompare(t[0])});var r={};r[t.url]=1,r[t.url]=1,"/"!=t.url.slice(-1)&&(r[t.url+"/"]=1);for(var n=0,a=e.length;n<a;n++){var i=String(e[n][0]).trim().replace(":80/","/");r[i]=1,"/"!=i.slice(-1)&&(r[i+"/"]=1)}for(var l="|",o={name:"root",children:[]},n=0;n<a;n++){var s=function(e){for(var t=e.trim().split("/"),n=[],a=1;a<t.length;a++){if(t.slice(0,a).join("/")in r==!1&&a>0){var i=t.slice(0,a).join("/").length;n.push(i)}}if(n.length>0){for(var o=e,s=1;s<n.length;s++){var c=n[s];o=o.substr(0,c)+l+o.substr(c+1)}return o}return e}(e[n][0]),c=+e[n][1];if(!isNaN(c)){var u=s.split("/");u=u.map(function(e){return e.replace(/\|/g,"/")});for(var d=o,h=0;h<u.length;h++){var p,f=d.children,v=u[h];if(h+1<u.length){for(var m=!1,g=0;g<f.length;g++)if(f[g].name==v){p=f[g],m=!0;break}m||(p={name:v,children:[]},f.push(p)),d=p}else p={name:v,size:c},f.push(p)}}}return o}(m);!function(e){p.append("svg:circle").attr("r",u).style("opacity",0);var t=d3.hierarchy(e).sum(function(e){return e.size}).sort(function(e,t){return t.value-e.value}),r=f(t).descendants(),i=p.data([e]).selectAll("path").data(r).enter().append("svg:path").attr("display",function(e){return e.depth?null:"none"}).attr("d",v).attr("fill-rule","evenodd").style("fill",function(e){return"end"==e.data.name?"#000000":d((e.children?e:e.parent).data.name)}).style("opacity",1).style("cursor","pointer").on("mouseover",a).on("click",n);d3.select("#d3_container").on("mouseleave",l),h=i.datum().value}(g)}function a(e,t){var r="",n=2;2==t[e].length&&(n=1);for(var a=n;a<t[e].length;a++)r=a!=t[e].length-1?r+t[e][a]+" ,1\n":r+t[e][a]+" ,1";return r}this.element=e,this.option=t;var i=0;t.url&&(function(e){var t=document.createElement("div");t.setAttribute("class","rt-content");var r=document.createElement("div");r.setAttribute("class","div-btn");var n=document.createElement("p");n.setAttribute("class","sequence");var a=document.createElement("div");a.setAttribute("id","chart");var i=document.createElement("img");i.setAttribute("src","../src/img/logo-animate.svg"),i.setAttribute("class","rt-indicator"),a.appendChild(i),t.appendChild(r),t.appendChild(n),t.appendChild(a),t.style.display="block",e.appendChild(t)}(e),function(e,t){var r=/http:\/\//,n=/https:\/\//,a=/\/$/;e.replace(r,""),e.replace(n,""),e.replace(a,"");var i="https://web.archive.org/web/timemap/json?url="+e+"/&fl=timestamp:4,original,urlkey&matchType=prefix&filter=statuscode:200&filter=mimetype:text/html&collapse=urlkey&collapse=timestamp:4",l=new XMLHttpRequest;l.open("GET",i,!0),l.onerror=function(){t(!1,"An error occured. Please refresh the page and try again")},l.ontimeout=function(){t(!1,"Timeout, Please refresh the page and try again")},l.onload=function(){var e=JSON.parse(l.responseText);0==e.length&&t(!0,[]);var r=function(){for(var t=new Array,r=0,n=1;n<e.length;n++)e[n][1].match(/jpg|pdf|png|form|gif/)||(e[n][1]=function(){for(var t=e[n][2].split(","),r="",a=0;a<t.length-1;a++)r=0==a?t[0]:t[a]+"."+r;return"/"==t[t.length-1].slice(-1)?"http://www."+t[t.length-1].replace(")/","."+r+"/"):"http://www."+t[t.length-1].replace(")/","."+r+"/")+"/"}(),1==n?(t[0]=new Array,t[0].push(e[1][1]),t[0].push(e[1][0])):e[n-1][1]==e[n][1]?t[r].push(e[n][0]):(r++,t[r]=new Array,t[r].push(e[n][1]),t[r].push(e[n][0])));return t}(),n=function(){for(var e=new Array,t=1;t<r[0].length;t++)e[t-1]=new Array,e[t-1].push(r[0][t]);for(var t=0;t<r.length;t++)for(var n=r[t][0],a=1;a<r[t].length;a++){var i=r[t][a],l=0;if(void 0!=e[l]){for(;void 0!=e[l]&&e[l][0]!=i;)l++;void 0!=e[l]&&e[l].push(n)}}for(var t=0;t<e.length;t++)for(var a=1;a<e[t].length;a++){var n;e[t][a].includes("http")?n=e[t][a].substring(7):e[t][a].includes("https")&&(n=e[t][a].sugstring(8)),n=n.slice(0,-1),n.includes("//")&&(n=n.split("//").join("/")),n=n.split("/").join("/"),e[t][a]=n}return e}(),a=function(){for(var e=new Array,t=0;t<n.length;t++)n[t].length>1&&e.push(n[t][0]);return e}();t(!0,null,a,n)},l.send()}(t.url,function(n,a,i,l){e.querySelector(".rt-indicator").style.display="none",n&&r(e,t,i,l)}))}return t.prototype.show=function(){this.element.style.display="block"},t.prototype.hide=function(){this.element.style.display="none"},e.fn.radialtree=function(r){return this.each(function(){e.data(this,"radialtree")||e.data(this,"radialtree",new t(this,r))}),this},t});