/*!
 * =============================================================
 * radial-tree v1.0.0 - Radial Tree Library for Wayback Machine
 * https://github.com/internetarchive/wayback-radial-tree#readme
 *
 * (c) 2017 - Eagle19243
 * =============================================================
 */

!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):e.RadialTree=t(e.jQuery)}(this,function(e){function t(e,t){function n(e,t,n,l){var o=e.querySelector(".div-btn");e.querySelector(".year-btn")||n.forEach(function(s,c){var u=document.createElement("button");u.setAttribute("class","year-btn"),u.setAttribute("id",n[c]),u.innerHTML=n[c],u.onclick=function(o){var s=o.target;e.querySelector(".active-btn")&&e.querySelector(".active-btn").classList.remove("active-btn"),s.classList.add("active-btn"),i=s.id;var c=n.indexOf(s.id),u=a(c,l);r(e,t,u)},o.appendChild(u),c==n.length-1&&u.click()})}function r(e,t,n){function r(e){for(var t=i,n=e.ancestors().reverse(),r="",a=1;a<n.length&&"end"!=n[a].data.name;a++)r=r+"/"+n[a].data.name;window.open(l+"/web/"+t+"0630"+r)}function a(e){var t=e.ancestors().reverse();t.shift(),s(t),d3.selectAll("path").style("opacity",.3),p.selectAll("path").filter(function(e){return t.indexOf(e)>=0}).style("opacity",1)}function o(t){e.querySelector(".sequence").innerHTML="",d3.selectAll("path").on("mouseover",null),d3.selectAll("path").transition().style("opacity",1).on("end",function(){d3.select(this).on("mouseover",a)})}function s(t){var n=t,r=e.querySelector(".sequence"),a="",i=document.createElement("span");i.setAttribute("class","symb"),i.innerHTML="/";for(var l=0;l<n.length;l++)a=0==l?" "+n[l].data.name:a+i.innerHTML+n[l].data.name;r.innerHTML=a}e.querySelector(".sequence").innerHTML="",e.querySelector("#chart").innerHTML="";var c=e.querySelector("#chart").offsetWidth,u=e.querySelector("#chart").offsetWidth,d=Math.min(c,u)/2,h=d3.scaleOrdinal(d3.schemeCategory20b),p=d3.select("#chart").append("svg:svg").attr("width",c).attr("height",u).append("svg:g").attr("id","d3_container").attr("transform","translate("+c/2+","+u/2+")"),f=d3.partition().size([2*Math.PI,d*d]),v=d3.arc().startAngle(function(e){return e.x0}).endAngle(function(e){return e.x1}).innerRadius(function(e){return Math.sqrt(e.y0)}).outerRadius(function(e){return Math.sqrt(e.y1)}),m=d3.csvParseRows(n),g=function(e){e.sort(function(e,t){return e[0].length-t[0].length||e[0].localeCompare(t[0])});var n={};n[t.url]=1,n[t.url]=1,"/"!=t.url.slice(-1)&&(n[t.url+"/"]=1);for(var r=0,a=e.length;r<a;r++){var i=String(e[r][0]).trim().replace(":80/","/");n[i]=1,"/"!=i.slice(-1)&&(n[i+"/"]=1)}for(var l="|",o={name:"root",children:[]},r=0;r<a;r++){var s=function(e){for(var t=e.trim().split("/"),r=[],a=1;a<t.length;a++){if(t.slice(0,a).join("/")in n==!1&&a>0){var i=t.slice(0,a).join("/").length;r.push(i)}}if(r.length>0){for(var o=e,s=1;s<r.length;s++){var c=r[s];o=o.substr(0,c)+l+o.substr(c+1)}return o}return e}(e[r][0]),c=+e[r][1];if(!isNaN(c)){var u=s.split("/");u=u.map(function(e){return e.replace(/\|/g,"/")});for(var d=o,h=0;h<u.length;h++){var p,f=d.children,v=u[h];if(h+1<u.length){for(var m=!1,g=0;g<f.length;g++)if(f[g].name==v){p=f[g],m=!0;break}m||(p={name:v,children:[]},f.push(p)),d=p}else p={name:v,size:c},f.push(p)}}}return o}(m);!function(e){p.append("svg:circle").attr("r",d).style("opacity",0);var t=d3.hierarchy(e).sum(function(e){return e.size}).sort(function(e,t){return t.value-e.value}),n=f(t).descendants();p.data([e]).selectAll("path").data(n).enter().append("svg:path").attr("display",function(e){return e.depth?null:"none"}).attr("d",v).attr("fill-rule","evenodd").style("fill",function(e){return"end"==e.data.name?"#000000":h((e.children?e:e.parent).data.name)}).style("opacity",1).style("cursor","pointer").on("mouseover",a).on("click",r),d3.select("#d3_container").on("mouseleave",o)}(g)}function a(e,t){var n="",r=2;2==t[e].length&&(r=1);for(var a=r;a<t[e].length;a++)n=a!=t[e].length-1?n+t[e][a]+" ,1\n":n+t[e][a]+" ,1";return n}this.element=e,this.option=t;var i=0,l="https://web.archive.org";void 0!==t.baseURL&&(l=t.baseURL),t.url&&(function(e){var t=document.createElement("div");t.setAttribute("class","rt-content");var n=document.createElement("div");n.setAttribute("class","div-btn");var r=document.createElement("p");r.setAttribute("class","sequence");var a=document.createElement("div");a.setAttribute("id","chart");var i=document.createElement("img");i.setAttribute("src","../src/img/logo-animate.svg"),i.setAttribute("class","rt-indicator"),a.appendChild(i),t.appendChild(n),t.appendChild(r),t.appendChild(a),t.style.display="block",e.appendChild(t)}(e),function(e,t){var n=/http:\/\//,r=/https:\/\//,a=/\/$/;e.replace(n,""),e.replace(r,""),e.replace(a,"");var i=l+"/web/timemap/json?url="+e+"/&fl=timestamp:4,original,urlkey&matchType=prefix&filter=statuscode:200&filter=mimetype:text/html&collapse=urlkey&collapse=timestamp:4",o=new XMLHttpRequest;o.open("GET",i,!0),o.onerror=function(){t(!1,"An error occured. Please refresh the page and try again")},o.ontimeout=function(){t(!1,"Timeout, Please refresh the page and try again")},o.onload=function(){var e=JSON.parse(o.responseText);0==e.length&&t(!0,[]);var n=function(){for(var t=new Array,n=0,r=1;r<e.length;r++)e[r][1].match(/jpg|pdf|png|form|gif/)||(e[r][1]=function(){for(var t=e[r][2].split(","),n="",a=0;a<t.length-1;a++)n=0==a?t[0]:t[a]+"."+n;return"/"==t[t.length-1].slice(-1)?"http://www."+t[t.length-1].replace(")/","."+n+"/"):"http://www."+t[t.length-1].replace(")/","."+n+"/")+"/"}(),1==r?(t[0]=new Array,t[0].push(e[1][1]),t[0].push(e[1][0])):e[r-1][1]==e[r][1]?t[n].push(e[r][0]):(n++,t[n]=new Array,t[n].push(e[r][1]),t[n].push(e[r][0])));return t}(),r=function(){for(var e=new Array,t=1;t<n[0].length;t++)e[t-1]=new Array,e[t-1].push(n[0][t]);for(var t=0;t<n.length;t++)for(var r=n[t][0],a=1;a<n[t].length;a++){var i=n[t][a],l=0;if(void 0!=e[l]){for(;void 0!=e[l]&&e[l][0]!=i;)l++;void 0!=e[l]&&e[l].push(r)}}for(var t=0;t<e.length;t++)for(var a=1;a<e[t].length;a++){var r;e[t][a].includes("http")?r=e[t][a].substring(7):e[t][a].includes("https")&&(r=e[t][a].sugstring(8)),r=r.slice(0,-1),r.includes("//")&&(r=r.split("//").join("/")),r=r.split("/").join("/"),e[t][a]=r}return e}(),a=function(){for(var e=new Array,t=0;t<r.length;t++)r[t].length>1&&e.push(r[t][0]);return e}();t(!0,null,a,r)},o.send()}(t.url,function(r,a,i,l){e.querySelector(".rt-indicator").style.display="none",r&&n(e,t,i,l)}))}return t.prototype.show=function(){this.element.style.display="block"},t.prototype.hide=function(){this.element.style.display="none"},e.fn.radialtree=function(n){return this.each(function(){e.data(this,"radialtree")||e.data(this,"radialtree",new t(this,n))}),this},t});